schema: '2.0'
stages:
  predictions_wise_wolf_pyro_sdis_val:
    cmd:
    - uv run ./scripts/predict.py --save-dir ./data/interim/pyro-sdis/val/predictions/wise_wolf/
      --dir-images "./data/raw/pyro-sdis/images/val/" --filepath-weights ./data/external/models/wise_wolf/weights/yolov11s.pt
      --loglevel "info"
    deps:
    - path: ./data/external/models/wise_wolf/weights/yolov11s.pt
      hash: md5
      md5: 1b692922ce755191e20bb29d9ed8fad3
      size: 19261779
    - path: ./data/raw/pyro-sdis/images/val/
      hash: md5
      md5: 128120c2d9dfc1ac5ad01b0a9f38c0e4.dir
      size: 390351269
      nfiles: 4099
    - path: ./scripts/predict.py
      hash: md5
      md5: b4c1e04be798e497d7e13f542686397b
      size: 3861
    outs:
    - path: ./data/interim/pyro-sdis/val/predictions/wise_wolf/
      hash: md5
      md5: 44c3d8e94e7dcf86f34683c0249c8df6.dir
      size: 417823
      nfiles: 4099
  data_pyro_sdis_testset:
    cmd:
    - uv run ./scripts/install_local_huggingface_dataset.py --save-dir "./data/raw/pyro-sdis-testset/"
      --data-dir "./data/raw/pyro-sdis-testset-parquet/" --loglevel "info"
    deps:
    - path: ./data/raw/pyro-sdis-testset-parquet/
      hash: md5
      md5: 7b9d1f53b6b88d8233a90299969e3602.dir
      size: 408292029
      nfiles: 1
    - path: ./scripts/install_local_huggingface_dataset.py
      hash: md5
      md5: b7e473b5d93aa6aa572704f25833f00d
      size: 3637
    outs:
    - path: ./data/raw/pyro-sdis-testset/
      hash: md5
      md5: 694357d359cc048f59eeb3b1a85e47ee.dir
      size: 408834037
      nfiles: 7780
  predictions_legendary_field_pyro_sdis_val:
    cmd:
    - uv run ./scripts/predict.py --save-dir ./data/interim/pyro-sdis/val/predictions/legendary_field/
      --dir-images "./data/raw/pyro-sdis/images/val/" --filepath-weights ./data/external/models/legendary_field/weights/legendary-field-19.pt
      --loglevel "info"
    deps:
    - path: ./data/external/models/legendary_field/weights/legendary-field-19.pt
      hash: md5
      md5: ef2fb126dda23c82745a769e91b2a637
      size: 22510190
    - path: ./data/raw/pyro-sdis/images/val/
      hash: md5
      md5: 128120c2d9dfc1ac5ad01b0a9f38c0e4.dir
      size: 390351269
      nfiles: 4099
    - path: ./scripts/predict.py
      hash: md5
      md5: b4c1e04be798e497d7e13f542686397b
      size: 3861
    outs:
    - path: ./data/interim/pyro-sdis/val/predictions/legendary_field/
      hash: md5
      md5: a2da68b7885c7c974b865bac9d2a095b.dir
      size: 321758
      nfiles: 4099
  crops_wise_wolf_pyro_sdis_val:
    cmd:
    - uv run ./scripts/crop_with_prediction.py --save-dir ./data/interim/pyro-sdis/val/crops/wise_wolf/
      --target-size 224 --dir-images ./data/raw/pyro-sdis/images/val/ --dir-predictions
      ./data/interim/pyro-sdis/val/predictions/wise_wolf --loglevel "info"
    deps:
    - path: ./data/interim/pyro-sdis/val/predictions/wise_wolf
      hash: md5
      md5: 44c3d8e94e7dcf86f34683c0249c8df6.dir
      size: 417823
      nfiles: 4099
    - path: ./data/raw/pyro-sdis/images/val/
      hash: md5
      md5: 128120c2d9dfc1ac5ad01b0a9f38c0e4.dir
      size: 390351269
      nfiles: 4099
    - path: ./scripts/crop_with_prediction.py
      hash: md5
      md5: bf3133e45999d10eef5621dfd7bdaa9e
      size: 8193
    outs:
    - path: ./data/interim/pyro-sdis/val/crops/wise_wolf/
      hash: md5
      md5: 337d9ecb2026ff959744bd45d37cd65f.dir
      size: 64060412
      nfiles: 8425
  predictions_wise_wolf_FP_2024:
    cmd:
    - uv run ./scripts/predict.py --save-dir ./data/interim/FP_2024/predictions/wise_wolf/
      --dir-images ./data/raw/FP_2024/ --filepath-weights ./data/external/models/wise_wolf/weights/yolov11s.pt
      --loglevel "info"
    deps:
    - path: ./data/external/models/wise_wolf/weights/yolov11s.pt
      hash: md5
      md5: 1b692922ce755191e20bb29d9ed8fad3
      size: 19261779
    - path: ./data/raw/FP_2024/
      hash: md5
      md5: 66f296ca12df64fbf69dffbc5ea85b75.dir
      size: 19970165665
      nfiles: 137840
    - path: ./scripts/predict.py
      hash: md5
      md5: b4c1e04be798e497d7e13f542686397b
      size: 3861
    outs:
    - path: ./data/interim/FP_2024/predictions/wise_wolf/
      hash: md5
      md5: 73e6091aa6f71d09a6464fe4c1f34025.dir
      size: 586426
      nfiles: 136327
  crops_wise_wolf_FP_2024:
    cmd:
    - uv run ./scripts/crop_with_prediction.py --save-dir ./data/interim/FP_2024/crops/wise_wolf/
      --target-size 224 --dir-images ./data/raw/FP_2024/ --dir-predictions ./data/interim/FP_2024/predictions/wise_wolf
      --loglevel "info"
    deps:
    - path: ./data/interim/FP_2024/predictions/wise_wolf
      hash: md5
      md5: 73e6091aa6f71d09a6464fe4c1f34025.dir
      size: 586426
      nfiles: 136327
    - path: ./data/raw/FP_2024/
      hash: md5
      md5: 66f296ca12df64fbf69dffbc5ea85b75.dir
      size: 19970165665
      nfiles: 137840
    - path: ./scripts/crop_with_prediction.py
      hash: md5
      md5: bf3133e45999d10eef5621dfd7bdaa9e
      size: 8193
    outs:
    - path: ./data/interim/FP_2024/crops/wise_wolf/
      hash: md5
      md5: ca420836a065679e3d42d0e5a5b742b3.dir
      size: 130347161
      nfiles: 11857
  filter_data_pyrosdis_smoke:
    cmd:
    - uv run ./scripts/filter_data_pyrosdis_smoke.py --save-dir ./data/interim/filtered/smoke/pyro-sdis/
      --dir-dataset ./data/raw/pyro-sdis/ --loglevel "info"
    deps:
    - path: ./data/raw/pyro-sdis/
      hash: md5
      md5: b2315192e7f9ec2c619365b054af1d49.dir
      size: 3284791992
      nfiles: 67272
    - path: ./scripts/filter_data_pyrosdis_smoke.py
      hash: md5
      md5: 81493515027d7d6241c5d6b96a04a3a7
      size: 5432
    outs:
    - path: ./data/interim/filtered/smoke/pyro-sdis/
      hash: md5
      md5: aa679d6d979b824a9864839d220c4566.dir
      size: 2758576581
      nfiles: 56274
  filter_data_figlib_smoke:
    cmd:
    - uv run ./scripts/filter_data_figlib_smoke.py --save-dir ./data/interim/filtered/smoke/FIGLIB_ANNOTATED_RESIZED/
      --dir-dataset ./data/raw/FIGLIB_ANNOTATED_RESIZED/ --loglevel "info"
    deps:
    - path: ./data/raw/FIGLIB_ANNOTATED_RESIZED/
      hash: md5
      md5: f0d52fbcb9869713a0c8c0960b2bef25.dir
      size: 3317314396
      nfiles: 49516
    - path: ./scripts/filter_data_figlib_smoke.py
      hash: md5
      md5: 9ad84e9419327735976157eec193d4c3
      size: 5010
    outs:
    - path: ./data/interim/filtered/smoke/FIGLIB_ANNOTATED_RESIZED/
      hash: md5
      md5: 5aa650d552c162cfd440daa72d702edf.dir
      size: 1357857659
      nfiles: 20436
  filter_data_pyronear_ds_smoke:
    cmd:
    - uv run ./scripts/filter_data_pyronear_ds_smoke.py --save-dir ./data/interim/filtered/smoke/pyronear_ds_03_2024/
      --allowed-dataset-prefixes "pyronear" "awf" "random" "adf" --dir-dataset ./data/raw/pyronear_ds_03_2024/
      --loglevel "info"
    deps:
    - path: ./data/raw/pyronear_ds_03_2024/
      hash: md5
      md5: 6bcff221686ce4f5139eb6089cc31415.dir
      size: 2487440765
      nfiles: 33527
    - path: ./scripts/filter_data_pyronear_ds_smoke.py
      hash: md5
      md5: 8b7fda32cd9c367ab0859520ee10de6a
      size: 6139
    outs:
    - path: ./data/interim/filtered/smoke/pyronear_ds_03_2024/
      hash: md5
      md5: fe0e0b734ada24d9199df560618ef78e.dir
      size: 1064743236
      nfiles: 18678
  split_data_figlib:
    cmd:
    - uv run ./scripts/split_figlib.py --save-dir ./data/interim/data-split/smoke/FIGLIB_ANNOTATED_RESIZED/
      --dir-dataset ./data/interim/filtered/smoke/FIGLIB_ANNOTATED_RESIZED/ --random-seed
      0 --ratio-train-val 0.9 --loglevel "info"
    deps:
    - path: ./data/interim/filtered/smoke/FIGLIB_ANNOTATED_RESIZED/
      hash: md5
      md5: 5aa650d552c162cfd440daa72d702edf.dir
      size: 1357857659
      nfiles: 20436
    - path: ./scripts/split_figlib.py
      hash: md5
      md5: 61816e198380639e1574b664e0e65315
      size: 7438
    outs:
    - path: ./data/interim/data-split/smoke/FIGLIB_ANNOTATED_RESIZED/
      hash: md5
      md5: 3fb4cc46ec2cae0c2a6edf3d602d451b.dir
      size: 1351043118
      nfiles: 20344
  merge_smoke_datasets:
    cmd:
    - uv run ./scripts/merge_smoke_datasets.py --save-dir ./data/interim/data-split/smoke/wildfire/
      --dir-datasets ./data/interim/data-split/smoke/FIGLIB_ANNOTATED_RESIZED/ ./data/interim/filtered/smoke/pyro-sdis/
      ./data/interim/filtered/smoke/pyronear_ds_03_2024/ --loglevel "info"
    deps:
    - path: ./data/interim/data-split/smoke/FIGLIB_ANNOTATED_RESIZED/
      hash: md5
      md5: 3fb4cc46ec2cae0c2a6edf3d602d451b.dir
      size: 1351043118
      nfiles: 20344
    - path: ./data/interim/filtered/smoke/pyro-sdis/
      hash: md5
      md5: aa679d6d979b824a9864839d220c4566.dir
      size: 2758576581
      nfiles: 56274
    - path: ./data/interim/filtered/smoke/pyronear_ds_03_2024/
      hash: md5
      md5: fe0e0b734ada24d9199df560618ef78e.dir
      size: 1064743236
      nfiles: 18678
    - path: ./scripts/merge_smoke_datasets.py
      hash: md5
      md5: 21044ebf1e60b15eba7d721a31c3b3fc
      size: 4512
    outs:
    - path: ./data/interim/data-split/smoke/wildfire/
      hash: md5
      md5: ca8c6b81485f80139b1f850a6f081b52.dir
      size: 5174362935
      nfiles: 95296
  filter_data_false_positives_FP_2024:
    cmd:
    - uv run ./scripts/filter_data_false_positives.py --save-dir ./data/interim/filtered/false_positives/FP_2024/wise_wolf/
      --dir-dataset ./data/raw/FP_2024/ --dir-predictions ./data/interim/FP_2024/predictions/wise_wolf/
      --loglevel "info"
    deps:
    - path: ./data/interim/FP_2024/predictions/wise_wolf/
      hash: md5
      md5: 73e6091aa6f71d09a6464fe4c1f34025.dir
      size: 586426
      nfiles: 136327
    - path: ./data/raw/FP_2024/
      hash: md5
      md5: 66f296ca12df64fbf69dffbc5ea85b75.dir
      size: 19970165665
      nfiles: 137840
    - path: ./scripts/filter_data_figlib_smoke.py
      hash: md5
      md5: 9ad84e9419327735976157eec193d4c3
      size: 5010
    outs:
    - path: ./data/interim/filtered/false_positives/FP_2024/wise_wolf/
      hash: md5
      md5: e779c19d027f7d87197f5cb65e37f6fa.dir
      size: 765215320
      nfiles: 5482
  split_data_false_positives_FP_2024:
    cmd:
    - uv run ./scripts/split_false_positives.py --save-dir ./data/interim/data-split/false_positives/FP_2024/wise_wolf/
      --dir-dataset ./data/interim/filtered/false_positives/FP_2024/wise_wolf/ --random-seed
      0 --ratio-train-val 0.9 --ratio-val-test 0.5 --loglevel "info"
    deps:
    - path: ./data/interim/filtered/false_positives/FP_2024/wise_wolf/
      hash: md5
      md5: e779c19d027f7d87197f5cb65e37f6fa.dir
      size: 765215320
      nfiles: 5482
    - path: ./scripts/split_false_positives.py
      hash: md5
      md5: 090b224478def86bfe9498257fb1c3a8
      size: 9751
    outs:
    - path: ./data/interim/data-split/false_positives/FP_2024/wise_wolf/
      hash: md5
      md5: 6c10828a5427d3669b1a6daf0bb5f3a7.dir
      size: 765215320
      nfiles: 10964
  make_train_val_wildfire_dataset:
    cmd:
    - uv run ./scripts/make_train_val_dataset.py --save-dir ./data/processed/wildfire/
      --dir-data-split-smoke ./data/interim/data-split/smoke/wildfire/ --dir-data-split-false-positives
      ./data/interim/data-split/false_positives/FP_2024/wise_wolf/ --dirs-ultralytics-datasets
      ./data/interim/pyronear-platform/sequences-ultralytics/ --random-seed 0 --percentage-background-images
      0.1 --loglevel "info"
    deps:
    - path: ./data/interim/data-split/false_positives/FP_2024/wise_wolf/
      hash: md5
      md5: 6c10828a5427d3669b1a6daf0bb5f3a7.dir
      size: 765215320
      nfiles: 10964
    - path: ./data/interim/data-split/smoke/wildfire/
      hash: md5
      md5: ca8c6b81485f80139b1f850a6f081b52.dir
      size: 5174362935
      nfiles: 95296
    - path: ./data/interim/pyronear-platform/sequences-ultralytics/
      hash: md5
      md5: b7b54080327e996abb7b497074cecfc7.dir
      size: 162842665
      nfiles: 3159
    - path: ./scripts/make_train_val_dataset.py
      hash: md5
      md5: 42d185b92db339bb23edc795a2118d0b
      size: 11809
    outs:
    - path: ./data/processed/wildfire/
      hash: md5
      md5: d174c30a764b9e9cfbb8346aa48b5276.dir
      size: 5953116603
      nfiles: 107091
  make_test_wildfire_dataset:
    cmd:
    - uv run ./scripts/make_test_dataset.py --save-dir ./data/processed/wildfire_test/
      --dir-previous-test-dataset ./data/raw/Test_dataset_2025/ --dir-data-split-false-positives
      ./data/interim/data-split/false_positives/FP_2024/wise_wolf/ --dirs-ultralytics-datasets
      ./data/interim/pyronear-platform/sequences-ultralytics/ --random-seed 0 --percentage-background-images
      0.1 --loglevel "info"
    deps:
    - path: ./data/interim/data-split/false_positives/FP_2024/wise_wolf/
      hash: md5
      md5: 6c10828a5427d3669b1a6daf0bb5f3a7.dir
      size: 765215320
      nfiles: 10964
    - path: ./data/interim/pyronear-platform/sequences-ultralytics/
      hash: md5
      md5: b7b54080327e996abb7b497074cecfc7.dir
      size: 162842665
      nfiles: 3159
    - path: ./data/raw/Test_dataset_2025/
      hash: md5
      md5: 7783dfe29daf68814cd41989aa997add.dir
      size: 933790934
      nfiles: 11629
    - path: ./scripts/make_test_dataset.py
      hash: md5
      md5: 4b214de96f85c055d504e54932668efb
      size: 11581
    outs:
    - path: ./data/processed/wildfire_test/
      hash: md5
      md5: c875d3ac93ff7dc3b627283becae2e6d.dir
      size: 990586534
      nfiles: 13165
  analyze_wildfire_dataset:
    cmd:
    - uv run ./scripts/analyze_processed_dataset.py --save-dir ./data/reporting/wildfire/
      --filepath-data-yaml-train-val ./data/processed/wildfire/data.yaml --filepath-data-yaml-test
      ./data/processed/wildfire_test/data.yaml --loglevel "info"
    deps:
    - path: ./data/processed/wildfire/
      hash: md5
      md5: d174c30a764b9e9cfbb8346aa48b5276.dir
      size: 5953116603
      nfiles: 107091
    - path: ./data/processed/wildfire_test/
      hash: md5
      md5: c875d3ac93ff7dc3b627283becae2e6d.dir
      size: 990586534
      nfiles: 13165
    - path: ./scripts/analyze_processed_dataset.py
      hash: md5
      md5: e67889e4f9693db1181fb460c042bef5
      size: 24002
    outs:
    - path: ./data/reporting/wildfire/
      hash: md5
      md5: 09de5d5713d578a3eef8475680090fe1.dir
      size: 124678
      nfiles: 5
  build_manifest_dataset:
    cmd:
    - uv run ./scripts/build_manifest.py --save-dir ./data/reporting/manifest/ --dir-wildfire-dataset-train-val
      ./data/processed/wildfire/ --dir-wildfire-dataset-test ./data/processed/wildfire_test/
      --loglevel "info"
    deps:
    - path: ./data/processed/wildfire/
      hash: md5
      md5: d174c30a764b9e9cfbb8346aa48b5276.dir
      size: 5953116603
      nfiles: 107091
    - path: ./data/processed/wildfire_test/
      hash: md5
      md5: c875d3ac93ff7dc3b627283becae2e6d.dir
      size: 990586534
      nfiles: 13165
    - path: ./scripts/build_manifest.py
      hash: md5
      md5: 8039497a4390db665345905315ba01b3
      size: 4546
    outs:
    - path: ./data/reporting/manifest/
      hash: md5
      md5: da6124e2dd59c6693fa9a8ba82529b81.dir
      size: 19732
      nfiles: 1
  select_platform_sequences:
    cmd:
    - uv run python ./scripts/platform_train_loop/select_detections.py --dir-platform-annotated-sequences
      ./data/raw/pyronear-platform-annotated-sequences/ --dir-save ./data/interim/pyronear-platform/sequences/
      --number-detections-per-sequence-true-positive 3 --number-detections-per-sequence-false-positive
      3 --loglevel "info"
    deps:
    - path: ./data/raw/pyronear-platform-annotated-sequences/
      hash: md5
      md5: f7c0eee67938d55db8dd721af4ccb004.dir
      size: 1410959826
      nfiles: 14551
    - path: ./scripts/platform_train_loop/select_detections.py
      hash: md5
      md5: 0203d279d22087ab065ac9b1ff51c87b
      size: 13244
    outs:
    - path: ./data/interim/pyronear-platform/sequences/
      hash: md5
      md5: 704fec322efbd2f3062d46836e4a7119.dir
      size: 456604854
      nfiles: 4737
  split_platform_sequences:
    cmd:
    - uv run python ./scripts/platform_train_loop/split_selected_sequences.py --dir-platform-selected-sequences
      ./data/interim/pyronear-platform/sequences/ --dir-save ./data/interim/pyronear-platform/sequences-data-split/
      --random-seed 0 --ratio-train 0.8 --ratio-val-test 0.5 --loglevel "info"
    deps:
    - path: ./data/interim/pyronear-platform/sequences/
      hash: md5
      md5: 704fec322efbd2f3062d46836e4a7119.dir
      size: 456604854
      nfiles: 4737
    - path: ./scripts/platform_train_loop/split_selected_sequences.py
      hash: md5
      md5: 88c2ac78f4980e788ebfd0b60acc5f7b
      size: 11394
    outs:
    - path: ./data/interim/pyronear-platform/sequences-data-split/
      hash: md5
      md5: dc479141fafebc998bae781d14673ba1.dir
      size: 456604854
      nfiles: 4737
  make_ultralytics_dataset_from_platform_sequences:
    cmd:
    - uv run python ./scripts/platform_train_loop/make_ultralytics_dataset.py --dir-save
      ./data/interim/pyronear-platform/sequences-ultralytics/ --dir-data-split ./data/interim/pyronear-platform/sequences-data-split/
      --loglevel "info"
    deps:
    - path: ./data/interim/pyronear-platform/sequences-data-split/
      hash: md5
      md5: dc479141fafebc998bae781d14673ba1.dir
      size: 456604854
      nfiles: 4737
    - path: ./scripts/platform_train_loop/make_ultralytics_dataset.py
      hash: md5
      md5: 6c83dd7f08415e1ac4bf83b0cfaad529
      size: 11218
    outs:
    - path: ./data/interim/pyronear-platform/sequences-ultralytics/
      hash: md5
      md5: b7b54080327e996abb7b497074cecfc7.dir
      size: 162842665
      nfiles: 3159
